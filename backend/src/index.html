<script src="../socket.io/socket.io.js"></script>

<style>
  body {
    background: #0f0f0f;
    color: #f1f1f1;
    font-family: "Inter", sans-serif;
    padding: 20px;
  }

  #channel-select {
    width: 200px;
    padding: 10px;
    background: #1f1f1f;
    color: white;
    border: 1px solid #333;
    border-radius: 6px;
    margin-bottom: 15px;
  }

  #log-container {
    background: #1a1a1a;
    border: 1px solid #333;
    padding: 15px;
    border-radius: 10px;
    height: 60vh;
    overflow-y: auto;
    box-shadow: 0 0 10px #0005;
    font-size: 14px;
  }

  pre {
    margin: 0;
    padding: 4px 0;
    border-bottom: 1px solid #222;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  #controls {
    margin-top: 15px;
    display: flex;
    justify-content: space-between;
  }

  button {
    padding: 10px 15px;
    background: linear-gradient(135deg, #4f46e5, #9333ea);
    color: white;
    border: none;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
    transition: 0.2s;
  }

  button:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 12px #0007;
  }
</style>

<!-- Channel Selector -->
<select id="channel-select">
  <option value="test-frontend">Frontend Build Logs</option>
  <option value="test-flamenodes">FlameNodes Build Logs</option>
  <option value="proxy">Proxy Logs</option>
</select>

<!-- Log Window -->
<div id="log-container"></div>

<!-- Controls -->
<div id="controls">
  <button onclick="clearLogs()">Clear Logs</button>
</div>

<script>
  const socket = io();
  const logContainer = document.getElementById("log-container");
  const channelSelect = document.getElementById("channel-select");

  let currentChannel = channelSelect.value;

  // Ask backend for old logs for the initial channel
  socket.emit("subscribe", currentChannel);

  // Listen for log messages on any channel
  socket.onAny((event, data) => {
    if (event === currentChannel) {
      addLog(data);
    }
  });

  function addLog(data) {
    const pre = document.createElement("pre");
    pre.textContent = data;
    logContainer.appendChild(pre);
    logContainer.scrollTop = logContainer.scrollHeight;
  }

  // When channel is changed
  channelSelect.addEventListener("change", () => {
    currentChannel = channelSelect.value;

    // Clear UI
    logContainer.innerHTML = "";

    // Ask server to send old logs for new channel
    socket.emit("subscribe", currentChannel);
  });

  // Clear screen (not backend)
  function clearLogs() {
    logContainer.innerHTML = "";
  }
</script>
